//
//  Keycodes.swift
//  OpenBangla
//
//  Created by Muhammad Mominul Huque on 25/10/25.
//  Copyright Â© 2025 OpenBangla. All rights reserved.
//

import Foundation

// Mac Virtual Keycode Mappings
// https://boredzo.org/blog/wp-content/uploads/2007/05/IMTx-virtual-keycodes.pdf

// Key code constants of Riti library
let VC_GRAVE: UInt16 = 0x0029
let VC_TILDE: UInt16 = 0x0001
let VC_1: UInt16 = 0x0002
let VC_2: UInt16 = 0x0003
let VC_3: UInt16 = 0x0004
let VC_4: UInt16 = 0x0005
let VC_5: UInt16 = 0x0006
let VC_6: UInt16 = 0x0007
let VC_7: UInt16 = 0x0008
let VC_8: UInt16 = 0x0009
let VC_9: UInt16 = 0x000A
let VC_0: UInt16 = 0x000B

let VC_EXCLAIM: UInt16 = 0x003B
let VC_AT: UInt16 = 0x003C
let VC_HASH: UInt16 = 0x003D
let VC_DOLLAR: UInt16 = 0x003E
let VC_PERCENT: UInt16 = 0x003F
let VC_CIRCUM: UInt16 = 0x0040
let VC_AMPERSAND: UInt16 = 0x0041
let VC_ASTERISK: UInt16 = 0x0042
let VC_PAREN_LEFT: UInt16 = 0x0043
let VC_PAREN_RIGHT: UInt16 = 0x0044
let VC_UNDERSCORE: UInt16 = 0x0057
let VC_PLUS: UInt16 = 0x0058

let VC_MINUS: UInt16 = 0x000C
let VC_EQUALS: UInt16 = 0x000D

let VC_A: UInt16 = 0xA096
let VC_B: UInt16 = 0xA097
let VC_C: UInt16 = 0xA098
let VC_D: UInt16 = 0xA099
let VC_E: UInt16 = 0xA09A
let VC_F: UInt16 = 0xA09B
let VC_G: UInt16 = 0xA09C
let VC_H: UInt16 = 0xA09D
let VC_I: UInt16 = 0xA09E
let VC_J: UInt16 = 0xA09F
let VC_K: UInt16 = 0xA0A0
let VC_L: UInt16 = 0xA0A1
let VC_M: UInt16 = 0xA0A2
let VC_N: UInt16 = 0xA0A3
let VC_O: UInt16 = 0xA0A4
let VC_P: UInt16 = 0xA0A5
let VC_Q: UInt16 = 0xA0A6
let VC_R: UInt16 = 0xA0A7
let VC_S: UInt16 = 0xA0A8
let VC_T: UInt16 = 0xA0A9
let VC_U: UInt16 = 0xA0AA
let VC_V: UInt16 = 0xA0AB
let VC_W: UInt16 = 0xA0AC
let VC_X: UInt16 = 0xA0AD
let VC_Y: UInt16 = 0xA0AE
let VC_Z: UInt16 = 0xA0AF

let VC_A_SHIFT: UInt16 = 0xA0B4
let VC_B_SHIFT: UInt16 = 0xA0B5
let VC_C_SHIFT: UInt16 = 0xA0B6
let VC_D_SHIFT: UInt16 = 0xA0B7
let VC_E_SHIFT: UInt16 = 0xA0B8
let VC_F_SHIFT: UInt16 = 0xA0B9
let VC_G_SHIFT: UInt16 = 0xA0BA
let VC_H_SHIFT: UInt16 = 0xA0BB
let VC_I_SHIFT: UInt16 = 0xA0BC
let VC_J_SHIFT: UInt16 = 0xA0BD
let VC_K_SHIFT: UInt16 = 0xA0BE
let VC_L_SHIFT: UInt16 = 0xA0BF
let VC_M_SHIFT: UInt16 = 0xA0C0
let VC_N_SHIFT: UInt16 = 0xA0C1
let VC_O_SHIFT: UInt16 = 0xA0C2
let VC_P_SHIFT: UInt16 = 0xA0C3
let VC_Q_SHIFT: UInt16 = 0xA0C4
let VC_R_SHIFT: UInt16 = 0xA0C5
let VC_S_SHIFT: UInt16 = 0xA0C6
let VC_T_SHIFT: UInt16 = 0xA0C7
let VC_U_SHIFT: UInt16 = 0xA0C8
let VC_V_SHIFT: UInt16 = 0xA0C9
let VC_W_SHIFT: UInt16 = 0xA0CA
let VC_X_SHIFT: UInt16 = 0xA0CB
let VC_Y_SHIFT: UInt16 = 0xA0CC
let VC_Z_SHIFT: UInt16 = 0xA0CD

let VC_BRACKET_LEFT: UInt16 = 0x001A
let VC_BRACKET_RIGHT: UInt16 = 0x001B
let VC_BACK_SLASH: UInt16 = 0x002B

let VC_BRACE_LEFT: UInt16 = 0x005B
let VC_BRACE_RIGHT: UInt16 = 0x005C
let VC_BAR: UInt16 = 0x005D

let VC_SEMICOLON: UInt16 = 0x0027
let VC_APOSTROPHE: UInt16 = 0x0028

let VC_COMMA: UInt16 = 0x0033
let VC_PERIOD: UInt16 = 0x0034
let VC_SLASH: UInt16 = 0x0035

let VC_COLON: UInt16 = 0x0063
let VC_QUOTE: UInt16 = 0x0064
let VC_LESS: UInt16 = 0x0065
let VC_GREATER: UInt16 = 0x0066
let VC_QUESTION: UInt16 = 0x0067

// Keypad keys
let VC_KP_DIVIDE: UInt16 = 0x0E35
let VC_KP_MULTIPLY: UInt16 = 0x0037
let VC_KP_SUBTRACT: UInt16 = 0x004A
let VC_KP_EQUALS: UInt16 = 0x0E0D
let VC_KP_ADD: UInt16 = 0x004E
let VC_KP_ENTER: UInt16 = 0x0E1C
let VC_KP_DECIMAL: UInt16 = 0x0053

let VC_KP_1: UInt16 = 0x004F
let VC_KP_2: UInt16 = 0x0050
let VC_KP_3: UInt16 = 0x0051
let VC_KP_4: UInt16 = 0x004B
let VC_KP_5: UInt16 = 0x004C
let VC_KP_6: UInt16 = 0x004D
let VC_KP_7: UInt16 = 0x0047
let VC_KP_8: UInt16 = 0x0048
let VC_KP_9: UInt16 = 0x0049
let VC_KP_0: UInt16 = 0x0052

/// Converts a character to its corresponding keycode
/// - Parameter char: The character to convert
/// - Returns: The keycode as UInt16, or nil if the character is not mapped
func charToKeycode(_ char: Character, macKeycode: UInt16) -> UInt16? {
    switch (char, macKeycode) {
    // Special characters
    case ("`", _): return VC_GRAVE
    case ("~", _): return VC_TILDE
    
    // Numbers & Numpad numbers
    case ("0", 82): return VC_KP_0
    case ("0", _): return VC_0
    
    case ("1", 83): return VC_KP_1
    case ("1", _): return VC_1
    
    case ("2", 84): return VC_KP_2
    case ("2", _): return VC_2
    
    case ("3", 85): return VC_KP_3
    case ("3", _): return VC_3
    
    case ("4", 86): return VC_KP_4
    case ("4", _): return VC_4
    
    case ("5", 87): return VC_KP_5
    case ("5", _): return VC_5
    
    case ("6", 88): return VC_KP_6
    case ("6", _): return VC_6
    
    case ("7", 89): return VC_KP_7
    case ("7", _): return VC_7
    
    case ("8", 91): return VC_KP_8
    case ("8", _): return VC_8
    
    case ("9", 92): return VC_KP_9
    case ("9", _): return VC_9
    
    
    // Shifted numbers
    case ("!", _): return VC_EXCLAIM
    case ("@", _): return VC_AT
    case ("#", _): return VC_HASH
    case ("$", _): return VC_DOLLAR
    case ("%", _): return VC_PERCENT
    case ("^", _): return VC_CIRCUM
    case ("&", _): return VC_AMPERSAND
    
    case ("*", 67): return VC_KP_MULTIPLY
    case ("*", _): return VC_ASTERISK
    
    case ("(", _): return VC_PAREN_LEFT
    case (")", _): return VC_PAREN_RIGHT
    
    // Lowercase letters
    case ("a", _): return VC_A
    case ("b", _): return VC_B
    case ("c", _): return VC_C
    case ("d", _): return VC_D
    case ("e", _): return VC_E
    case ("f", _): return VC_F
    case ("g", _): return VC_G
    case ("h", _): return VC_H
    case ("i", _): return VC_I
    case ("j", _): return VC_J
    case ("k", _): return VC_K
    case ("l", _): return VC_L
    case ("m", _): return VC_M
    case ("n", _): return VC_N
    case ("o", _): return VC_O
    case ("p", _): return VC_P
    case ("q", _): return VC_Q
    case ("r", _): return VC_R
    case ("s", _): return VC_S
    case ("t", _): return VC_T
    case ("u", _): return VC_U
    case ("v", _): return VC_V
    case ("w", _): return VC_W
    case ("x", _): return VC_X
    case ("y", _): return VC_Y
    case ("z", _): return VC_Z
    
    // Uppercase letters
    case ("A", _): return VC_A_SHIFT
    case ("B", _): return VC_B_SHIFT
    case ("C", _): return VC_C_SHIFT
    case ("D", _): return VC_D_SHIFT
    case ("E", _): return VC_E_SHIFT
    case ("F", _): return VC_F_SHIFT
    case ("G", _): return VC_G_SHIFT
    case ("H", _): return VC_H_SHIFT
    case ("I", _): return VC_I_SHIFT
    case ("J", _): return VC_J_SHIFT
    case ("K", _): return VC_K_SHIFT
    case ("L", _): return VC_L_SHIFT
    case ("M", _): return VC_M_SHIFT
    case ("N", _): return VC_N_SHIFT
    case ("O", _): return VC_O_SHIFT
    case ("P", _): return VC_P_SHIFT
    case ("Q", _): return VC_Q_SHIFT
    case ("R", _): return VC_R_SHIFT
    case ("S", _): return VC_S_SHIFT
    case ("T", _): return VC_T_SHIFT
    case ("U", _): return VC_U_SHIFT
    case ("V", _): return VC_V_SHIFT
    case ("W", _): return VC_W_SHIFT
    case ("X", _): return VC_X_SHIFT
    case ("Y", _): return VC_Y_SHIFT
    case ("Z", _): return VC_Z_SHIFT
    
    // Other symbols
    case ("-", 78): return VC_KP_SUBTRACT
    case ("-", _): return VC_MINUS
    
    case ("_", _): return VC_UNDERSCORE
    
    case ("=", 81): return VC_KP_EQUALS
    case ("=", _): return VC_EQUALS
    
    case ("+", 69): return VC_PLUS
    case ("+", _): return VC_PLUS
    
    case ("[", _): return VC_BRACKET_LEFT
    case ("]", _): return VC_BRACKET_RIGHT
    case ("{", _): return VC_BRACE_LEFT
    case ("}", _): return VC_BRACE_RIGHT
    case ("\\", _): return VC_BACK_SLASH
    case ("|", _): return VC_BAR
    
    case (";", _): return VC_SEMICOLON
    case (":", _): return VC_COLON
    case ("'", _): return VC_APOSTROPHE
    case ("\"", _): return VC_QUOTE
    
    case (",", _): return VC_COMMA
    case ("<", _): return VC_LESS
    
    case (".", 65): return VC_KP_DECIMAL
    case (".", _): return VC_PERIOD
    
    case (">", _): return VC_GREATER
    
    case ("/", 75): return VC_KP_DECIMAL
    case ("/", _): return VC_SLASH
    
    case ("?", _): return VC_QUESTION
    
    default: return nil
    }
}

/// Maps Mac virtual keycodes (from Apple Extended Keyboard II) to VC_ keycodes
func macKeycodeToKeycode(_ macKeycode: UInt16, shift: Bool) -> UInt16? {
    switch (macKeycode, shift) {
    // Number row
    case (50, false): return VC_GRAVE      // `
    case (50, true): return VC_TILDE       // ~
    
    case (18, false): return VC_1
    case (18, true): return VC_EXCLAIM
    
    case (19, false): return VC_2
    case (19, true): return VC_AT
    
    case (20, false): return VC_3
    case (20, true): return VC_HASH
    
    case (21, false): return VC_4
    case (21, true): return VC_DOLLAR
    
    case (23, false): return VC_5
    case (23, true): return VC_PERCENT
    
    case (22, false): return VC_6
    case (22, true): return VC_CIRCUM
    
    case (26, false): return VC_7
    case (26, true): return VC_AMPERSAND
    
    case (28, false): return VC_8
    case (28, true): return VC_ASTERISK
        
    case (25, false): return VC_9
    case (25, true): return VC_PAREN_LEFT
    
    case (29, false): return VC_0
    case (29, true): return VC_PAREN_RIGHT
    
    case (27, false): return VC_MINUS      // -
    case (27, true): return VC_UNDERSCORE  // _
    
    case (24, false): return VC_EQUALS     // =
    case (24, true): return VC_PLUS        // +
    
    // Top letter row
    case (12, false): return VC_Q
    case (12, true): return VC_Q_SHIFT
    
    case (13, false): return VC_W
    case (13, true): return VC_W_SHIFT
    
    case (14, false): return VC_E
    case (14, true): return VC_E_SHIFT
    
    case (15, false): return VC_R
    case (15, true): return VC_R_SHIFT
    
    case (17, false): return VC_T
    case (17, true): return VC_T_SHIFT
    
    case (16, false): return VC_Y
    case (16, true): return VC_Y_SHIFT
    
    case (32, false): return VC_U
    case (32, true): return VC_U_SHIFT
    
    case (34, false): return VC_I
    case (34, true): return VC_I_SHIFT
    
    case (31, false): return VC_O
    case (31, true): return VC_O_SHIFT
    
    case (35, false): return VC_P
    case (35, true): return VC_P_SHIFT
    
    case (33, false): return VC_BRACKET_LEFT   // [
    case (33, true): return VC_BRACE_LEFT      // {
    
    case (30, false): return VC_BRACKET_RIGHT  // ]
    case (30, true): return VC_BRACE_RIGHT     // }
    
    case (42, false): return VC_BACK_SLASH     // \
    case (42, true): return VC_BAR            // |
    
    // Home row
    case (0, false): return VC_A
    case (0, true): return VC_A_SHIFT
    
    case (1, false): return VC_S
    case (1, true): return VC_S_SHIFT
    
    case (2, false): return VC_D
    case (2, true): return VC_D_SHIFT
    
    case (3, false): return VC_F
    case (3, true): return VC_F_SHIFT
    
    case (5, false): return VC_G
    case (5, true): return VC_G_SHIFT
    
    case (4, false): return VC_H
    case (4, true): return VC_H_SHIFT
    
    case (38, false): return VC_J
    case (38, true): return VC_J_SHIFT
    
    case (40, false): return VC_K
    case (40, true): return VC_K_SHIFT
    
    case (37, false): return VC_L
    case (37, true): return VC_L_SHIFT
    
    case (41, false): return VC_SEMICOLON  // ;
    case (41, true): return VC_COLON      // :
    
    case (39, false): return VC_APOSTROPHE // '
    case (39, true): return VC_QUOTE      // "
    
    // Bottom letter row
    case (6, false): return VC_Z
    case (6, true): return VC_Z_SHIFT
    
    case (7, false): return VC_X
    case (7, true): return VC_X_SHIFT
    
    case (8, false): return VC_C
    case (8, true): return VC_C_SHIFT
    
    case (9, false): return VC_V
    case (9, true): return VC_V_SHIFT
    
    case (11, false): return VC_B
    case (11, true): return VC_B_SHIFT
    
    case (45, false): return VC_N
    case (45, true): return VC_N_SHIFT
    
    case (46, false): return VC_M
    case (46, true): return VC_M_SHIFT
    
    case (43, false): return VC_COMMA      // ,
    case (43, true): return VC_LESS       // <
    
    case (47, false): return VC_PERIOD     // .
    case (47, true): return VC_GREATER     // >
    
    case (44, false): return VC_SLASH      // /
    case (44, true): return VC_QUESTION    // ?
    
    // Numeric keypad
    case (81, _): return VC_KP_EQUALS
    case (75, _): return VC_KP_DIVIDE
    case (67, _): return VC_KP_MULTIPLY
    case (89, _): return VC_KP_7
    case (91, _): return VC_KP_8
    case (92, _): return VC_KP_9
    case (78, _): return VC_KP_SUBTRACT
    case (86, _): return VC_KP_4
    case (87, _): return VC_KP_5
    case (88, _): return VC_KP_6
    case (69, _): return VC_KP_ADD
    case (83, _): return VC_KP_1
    case (84, _): return VC_KP_2
    case (85, _): return VC_KP_3
    case (76, _): return VC_KP_ENTER
    case (82, _): return VC_KP_0
    case (65, _): return VC_KP_DECIMAL
    
    default: return nil
    }
}
